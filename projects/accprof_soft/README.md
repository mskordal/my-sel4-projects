# Software Library implementation of the HLS IP
This directory consists of an SeL4 library that works like the HLS IP AccProf.
The source contains `accprof_soft_top_func` which is similar to the top function of
the HLS IP. Additionaly it contains a print function that prints the generated
call graph in csv format.

Furthermore, there are `cmake` files which are used to integrate the library to
the SeL4 project built. Below we describe the files

## Findaccprof_soft.cmake
This file is used to connect this library to the main project. The main project's `CMakeLists.txt` uses the macro `find_package` which tries to locate this file
in the paths specified in the `CMAKE_MODULE_PATH` variable. This is set in the
`settings.cmake` file in the projects root directory and the path to `projects`
is already appended to the variable. This is why this directory resides in the
project directory. If we wanted to move this directory to a different path, we
would have to append the path to `CMAKE_MODULE_PATH` as well.

The macro `accprof_soft_import_library` defined here is called in the `CMakeLists.txt` file of the project to add the directory path to the project.

## CMakeLists.txt
Each library imported to an SeL4 project must use a `CMakeLists.txt` file to be
integrated to it. First, we have a conditional for the architecture which is
probably required to build for aarch64. Then we use the `file` macro to create a
list of the source files of this library. We then sort the list. I don't know if
this is required. We add the library. We then use the
`target_include_directories` macro to make the directory with the header files
visible to the main project. Finally the `target_link_libraries` macro lists
other libraries that are dependencies of this library.

## src/accprof_soft.c
Contains two functions:
- **accprof_soft_top_func**: Works exactly like the hardware function. Check the
  [vitis_hls](https://github.com/mskordal/my-sel4-projects/tree/main/vitis_hls)
  directory for further information.
- **accprof_soft_print**: Prints the call graph generated by the top function in a
  csv format.

## include/accprof_soft.h
Contains the declaration of the beforemetioned functions.
